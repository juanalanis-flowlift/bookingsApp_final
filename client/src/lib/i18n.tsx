import { createContext, useContext, useState, useEffect, type ReactNode } from "react";

export type Language = "en" | "es";

interface I18nContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string, params?: Record<string, string | number>) => string;
}

const I18nContext = createContext<I18nContextType | null>(null);

const SPANISH_SPEAKING_COUNTRIES = [
  "ES", "MX", "AR", "CO", "PE", "VE", "CL", "EC", "GT", "CU",
  "BO", "DO", "HN", "PY", "SV", "NI", "CR", "PA", "UY", "PR", "GQ"
];

export const translations: Record<Language, Record<string, string>> = {
  en: {
    "app.name": "FlowLift",
    "app.tagline": "Smart booking for service businesses",
    
    "nav.dashboard": "Dashboard",
    "nav.services": "Services",
    "nav.bookings": "Bookings",
    "nav.availability": "Availability",
    "nav.settings": "Settings",
    "nav.team": "Team",
    "nav.logout": "Logout",
    
    "sidebar.menu": "Menu",
    "sidebar.quickActions": "Quick Actions",
    
    "landing.hero.title": "Smart Booking for",
    "landing.hero.titleHighlight": "Service Businesses",
    "landing.hero.subtitle": "Stop juggling calls and messages. Let your customers book appointments online while you focus on what you do best.",
    "landing.hero.cta": "Get Started Free",
    "landing.hero.learnMore": "Learn More",
    "landing.signIn": "Sign In",
    
    "landing.features.title": "Everything You Need to Manage Bookings",
    "landing.features.subtitle": "Simple, powerful tools designed for small service businesses",
    "landing.features.easyScheduling": "Easy Scheduling",
    "landing.features.easySchedulingDesc": "Let customers book appointments 24/7 with your custom booking page",
    "landing.features.availabilityControl": "Availability Control",
    "landing.features.availabilityControlDesc": "Set your working hours, breaks, and block off time when you're unavailable",
    "landing.features.customerManagement": "Customer Management",
    "landing.features.customerManagementDesc": "Track bookings, customer details, and notes all in one place",
    "landing.features.simpleAnalytics": "Simple Analytics",
    "landing.features.simpleAnalyticsDesc": "See your upcoming bookings and track your business growth",
    
    "landing.benefits.title": "Built for Service Professionals",
    "landing.benefits.subtitle": "Whether you're a barber, hairdresser, massage therapist, or rental business",
    "landing.benefits.noDoubleBookings": "No double bookings",
    "landing.benefits.mobileFriendly": "Mobile-friendly booking page",
    "landing.benefits.instantConfirmations": "Instant booking confirmations",
    "landing.benefits.multipleServices": "Manage multiple services",
    "landing.benefits.customProfile": "Custom business profile",
    "landing.benefits.multiTenant": "Multi-tenant ready",
    
    "landing.cta.title": "Ready to Streamline Your Bookings?",
    "landing.cta.subtitle": "Join businesses that save hours every week with automated scheduling",
    "landing.cta.button": "Start Free Today",
    
    "booking.selectService": "Select a Service",
    "booking.noServices": "No services available at this time.",
    "booking.select": "Select",
    "booking.back": "Back",
    "booking.selectedService": "Selected Service",
    "booking.selectDate": "Select Date",
    "booking.availableTimes": "Available Times",
    "booking.selectDateFirst": "Select a Date First",
    "booking.pleaseSelectDate": "Please select a date to see available times",
    "booking.noSlots": "No available slots for this date",
    "booking.summary": "Booking Summary",
    "booking.yourDetails": "Your Details",
    "booking.name": "Name",
    "booking.email": "Email",
    "booking.phone": "Phone (Optional)",
    "booking.notes": "Notes (Optional)",
    "booking.confirmBooking": "Confirm Booking",
    "booking.processing": "Processing...",
    "booking.confirmed": "Booking Confirmed!",
    "booking.thankYou": "Thank you for booking with",
    "booking.confirmationSent": "A confirmation email has been sent to your email address. You can manage all your bookings from your account.",
    "booking.requestSubmitted": "Booking Request Submitted",
    "booking.pendingConfirmation": "Your booking request has been sent to {business}. Please wait for confirmation.",
    "booking.pendingConfirmationNote": "The business will review your request and send you a confirmation email once approved.",
    "booking.bookAnother": "Book Another Appointment",
    "booking.viewMyBookings": "View My Bookings",
    "booking.businessNotFound": "Business Not Found",
    "booking.businessNotFoundDesc": "The booking page you're looking for doesn't exist.",
    "booking.step.service": "Service",
    "booking.step.datetime": "Date & Time",
    "booking.step.details": "Details",
    "booking.min": "min",
    "booking.addToCalendar": "Add to Calendar",
    "booking.googleCalendar": "Google Calendar",
    "booking.outlookCalendar": "Outlook",
    "booking.appleCalendar": "Apple Calendar",
    
    "settings.title": "Business Settings",
    "settings.subtitle": "Manage your business profile and public booking page",
    "settings.businessInfo": "Business Information",
    "settings.businessName": "Business Name",
    "settings.category": "Category",
    "settings.selectCategory": "Select a category",
    "settings.bookingPageUrl": "Booking Page URL",
    "settings.urlDescription": "This is the URL where customers will book your services",
    "settings.description": "Description",
    "settings.descriptionPlaceholder": "Tell customers about your business...",
    "settings.location": "Location",
    "settings.address": "Address",
    "settings.city": "City",
    "settings.country": "Country",
    "settings.contact": "Contact",
    "settings.phone": "Phone",
    "settings.email": "Email",
    "settings.previewBooking": "Preview Booking Page",
    "settings.save": "Update",
    "settings.create": "Create Business",
    "settings.saving": "Saving...",
    "settings.changeLogo": "Change Logo",
    "settings.uploading": "Uploading...",
    "settings.urlCopied": "Booking URL copied!",
    "settings.profileSaved": "Business profile saved",
    "settings.logoUpdated": "Logo updated successfully",
    "settings.language": "Language",
    "settings.languageDescription": "Select your preferred language for the app and email notifications",
    "settings.preferences": "Preferences",
    
    "services.title": "Services",
    "services.subtitle": "Manage the services you offer to customers",
    "services.addService": "Add Service",
    "services.editService": "Edit Service",
    "services.noServices": "No services yet",
    "services.noServicesDesc": "Add your first service to start accepting bookings",
    "services.name": "Service Name",
    "services.description": "Description",
    "services.duration": "Duration (minutes)",
    "services.price": "Price",
    "services.tags": "Tags",
    "services.tagsPlaceholder": "Add tags (comma separated)",
    "services.active": "Active",
    "services.requiresConfirmation": "Requires Confirmation",
    "services.requiresConfirmationDesc": "Bookings require your approval before being confirmed",
    "services.confirmation": "Confirmation",
    "services.save": "Save Service",
    "services.cancel": "Cancel",
    "services.delete": "Delete",
    "services.deleteConfirm": "Are you sure you want to delete this service?",
    
    "bookings.title": "Bookings",
    "bookings.subtitle": "View and manage your customer appointments",
    "bookings.noBookings": "No bookings yet",
    "bookings.noBookingsDesc": "When customers book appointments, they will appear here",
    "bookings.calendar": "Calendar",
    "bookings.list": "List",
    "bookings.upcoming": "Upcoming",
    "bookings.past": "Past",
    "bookings.all": "All",
    "bookings.pending": "Pending",
    "bookings.confirmed": "Confirmed",
    "bookings.cancelled": "Cancelled",
    "bookings.confirm": "Confirm",
    "bookings.cancel": "Cancel",
    "bookings.viewDetails": "View Details",
    "bookings.cancelBooking": "Cancel Booking",
    "bookings.customerNotes": "Customer Notes",
    "bookings.internalNotes": "Internal Notes",
    "bookings.modify": "Modify",
    "bookings.modifyBooking": "Modify Booking",
    "bookings.modificationPending": "Modification Pending",
    "bookings.currentAppointment": "Current Appointment",
    "bookings.proposedNewDate": "Proposed New Date",
    "bookings.startTime": "Start Time",
    "bookings.endTime": "End Time",
    "bookings.selectTime": "Select time",
    "bookings.reasonForChange": "Reason for Change",
    "bookings.reasonForChangePlaceholder": "Optional: explain why this change is needed",
    "bookings.sendModificationRequest": "Send Modification Request",
    "bookings.modificationRequestSent": "Modification request sent to customer",
    "bookings.modificationRequestFailed": "Failed to send modification request",
    
    "confirmModification.title": "Confirm Appointment Change",
    "confirmModification.subtitle": "Please review the proposed changes to your appointment",
    "confirmModification.currentTime": "Current Time",
    "confirmModification.proposedTime": "Proposed New Time",
    "confirmModification.reason": "Reason for Change",
    "confirmModification.confirm": "Confirm Change",
    "confirmModification.confirming": "Confirming...",
    "confirmModification.confirmed": "Appointment Updated!",
    "confirmModification.confirmedDesc": "Your appointment has been updated to the new time.",
    "confirmModification.notFound": "Request Not Found",
    "confirmModification.notFoundDesc": "This modification request was not found or has expired.",
    "confirmModification.expired": "Request Expired",
    "confirmModification.expiredDesc": "This modification request has expired. Please contact the business.",
    "confirmModification.error": "Error",
    "confirmModification.errorDesc": "There was an error processing your request.",

    "customerCancel.title": "Cancel Booking",
    "customerCancel.subtitle": "Please confirm you want to cancel this booking",
    "customerCancel.bookingDetails": "Booking Details",
    "customerCancel.service": "Service",
    "customerCancel.date": "Date",
    "customerCancel.time": "Time",
    "customerCancel.business": "Business",
    "customerCancel.reasonLabel": "Reason for cancellation (optional)",
    "customerCancel.reasonPlaceholder": "Please let us know why you're cancelling...",
    "customerCancel.confirmCancel": "Cancel Booking",
    "customerCancel.cancelling": "Cancelling...",
    "customerCancel.cancelled": "Booking Cancelled",
    "customerCancel.cancelledDesc": "Your booking has been cancelled successfully.",
    "customerCancel.notFound": "Booking Not Found",
    "customerCancel.notFoundDesc": "This booking link is invalid or has been cancelled already.",
    "customerCancel.alreadyCancelled": "Already Cancelled",
    "customerCancel.alreadyCancelledDesc": "This booking has already been cancelled.",
    "customerCancel.error": "Error",
    "customerCancel.errorDesc": "There was an error cancelling your booking.",
    "customerCancel.goBack": "Go Back",
    "customerCancel.keepBooking": "Keep Booking",

    "customerModify.title": "Modify Booking",
    "customerModify.subtitle": "Change your appointment date or time",
    "customerModify.currentBooking": "Current Booking",
    "customerModify.service": "Service",
    "customerModify.date": "Date",
    "customerModify.time": "Time",
    "customerModify.business": "Business",
    "customerModify.changeTime": "Change Date/Time",
    "customerModify.selectNewTime": "Select New Date & Time",
    "customerModify.selectDate": "Select Date",
    "customerModify.selectTime": "Select Time",
    "customerModify.selectDateFirst": "Please select a date first",
    "customerModify.noSlots": "No available time slots for this date",
    "customerModify.continue": "Continue",
    "customerModify.confirmChange": "Confirm Change",
    "customerModify.newBooking": "New Booking",
    "customerModify.confirmModify": "Confirm Modification",
    "customerModify.modifying": "Modifying...",
    "customerModify.modified": "Booking Modified",
    "customerModify.modifiedDesc": "Your appointment has been successfully rescheduled.",
    "customerModify.newDate": "New Date",
    "customerModify.newTime": "New Time",
    "customerModify.notFound": "Booking Not Found",
    "customerModify.notFoundDesc": "This booking link is invalid or has expired.",
    "customerModify.alreadyCancelled": "Booking Cancelled",
    "customerModify.alreadyCancelledDesc": "This booking has been cancelled and cannot be modified.",
    "customerModify.error": "Error",
    "customerModify.errorDesc": "There was an error loading your booking.",
    "customerModify.goBack": "Go Back",

    "team.title": "Team Members",
    "team.subtitle": "Manage your team and their schedules",
    "team.addMember": "Add Team Member",
    "team.editMember": "Edit Team Member",
    "team.members": "Team Members",
    "team.noMembers": "No team members yet. Add your first team member to get started.",
    "team.selectMember": "Select a Team Member",
    "team.selectMemberDescription": "Click on a team member to manage their services and availability.",
    "team.name": "Name",
    "team.namePlaceholder": "Enter team member name",
    "team.email": "Email",
    "team.emailPlaceholder": "Enter email address",
    "team.phone": "Phone",
    "team.phonePlaceholder": "Enter phone number",
    "team.role": "Role",
    "team.rolePlaceholder": "e.g., Stylist, Barber, Therapist",
    "team.roleDescription": "The role or specialization of this team member",
    "team.active": "Active",
    "team.activeDescription": "Inactive members won't be shown for bookings",
    "team.inactive": "Inactive",
    "team.services": "Services",
    "team.servicesDescription": "Select which services this team member can perform",
    "team.noServicesAvailable": "No services available. Create services first.",
    "team.availability": "Availability",
    "team.availabilityDescription": "Set working hours for each day of the week",
    "team.created": "Team member created successfully",
    "team.createError": "Failed to create team member",
    "team.updated": "Team member updated successfully",
    "team.updateError": "Failed to update team member",
    "team.deleted": "Team member deleted successfully",
    "team.deleteError": "Failed to delete team member",
    "team.servicesUpdated": "Services updated successfully",
    "team.servicesError": "Failed to update services",
    "team.availabilityUpdated": "Availability updated successfully",
    "team.availabilityError": "Failed to update availability",
    "team.deleteConfirmTitle": "Delete Team Member?",
    "team.deleteConfirmDescription": "This will permanently delete this team member and all their schedules. This action cannot be undone.",
    "team.setupBusinessFirst": "Please set up your business profile first.",
    
    "common.sending": "Sending...",
    "common.fillAllFields": "Please fill all required fields",
    
    "availability.title": "Availability",
    "availability.subtitle": "Set your working hours and manage time slots",
    "availability.workingHours": "Working Hours",
    "availability.closed": "Closed",
    "availability.open": "Open",
    "availability.startTime": "Start Time",
    "availability.endTime": "End Time",
    "availability.slotDuration": "Slot Duration",
    "availability.maxPerSlot": "Max Bookings Per Slot",
    "availability.save": "Save Availability",
    "availability.saved": "Availability saved successfully",
    "availability.to": "to",
    "availability.slotLabel": "Slot:",
    "availability.startDate": "Start Date",
    "availability.endDate": "End Date",
    "availability.reason": "Reason (optional)",
    "availability.setupFirst": "Please set up your business profile first.",
    "common.noBookingsOnDate": "No bookings on this date",
    
    "dashboard.title": "Dashboard",
    "dashboard.welcome": "Welcome back",
    "dashboard.todayBookings": "Today's Bookings",
    "dashboard.upcomingBookings": "Upcoming Bookings",
    "dashboard.totalServices": "Total Services",
    "dashboard.recentBookings": "Recent Bookings",
    "dashboard.viewAll": "View All",
    "dashboard.noBookingsToday": "No bookings scheduled for today",
    "dashboard.setupBusiness": "Set up your business",
    "dashboard.setupBusinessDesc": "Complete your business profile to start accepting bookings",
    "dashboard.goToSettings": "Go to Settings",
    
    "myBookings.title": "My Bookings",
    "myBookings.subtitle": "View and manage your appointments",
    "myBookings.enterEmail": "Enter your email to view bookings",
    "myBookings.email": "Email Address",
    "myBookings.sendLink": "Send Magic Link",
    "myBookings.linkSent": "Check your email for the login link",
    "myBookings.noBookings": "No bookings found",
    "myBookings.noBookingsDesc": "Book an appointment with a business to see it here",
    
    "days.sunday": "Sunday",
    "days.monday": "Monday",
    "days.tuesday": "Tuesday",
    "days.wednesday": "Wednesday",
    "days.thursday": "Thursday",
    "days.friday": "Friday",
    "days.saturday": "Saturday",
    
    "categories.barber": "Barber Shop",
    "categories.hairdresser": "Hair Salon",
    "categories.beauty_salon": "Beauty Salon",
    "categories.spa": "Spa & Wellness",
    "categories.massage": "Massage Therapy",
    "categories.nail_salon": "Nail Salon",
    "categories.inflatable_rentals": "Inflatable Rentals",
    "categories.party_services": "Party Services",
    "categories.photography": "Photography",
    "categories.fitness": "Fitness & Training",
    "categories.consulting": "Consulting",
    "categories.other": "Other Services",
    
    "common.loading": "Loading...",
    "common.error": "An error occurred",
    "common.save": "Save",
    "common.cancel": "Cancel",
    "common.delete": "Delete",
    "common.edit": "Edit",
    "common.add": "Add",
    "common.search": "Search",
    "common.filter": "Filter",
    "common.required": "Required",
    "common.optional": "Optional",
    "common.unauthorized": "Unauthorized",
    "common.loggingIn": "You are logged out. Logging in again...",
    "common.failedToSave": "Failed to save",
    "common.confirmed": "Confirmed",
    "common.pending": "Pending",
    "common.cancelled": "Cancelled",
    "common.status": "Status",
    "common.actions": "Actions",
    "common.inactive": "Inactive",
    "common.deleting": "Deleting...",
    "common.blockedTime": "Blocked Time",
    "common.addBlockedTime": "Add Blocked Time",
    "common.blockTimeOff": "Block Time Off",
    "common.noBlockedTimeScheduled": "No blocked time scheduled",
    "common.addTimeOffDescription": "Add time off for holidays, vacations, or breaks",
    "common.commaSeparated": "comma-separated",
    
    "booking.selectDateTime": "Date & Time",
    
    "dashboard.scheduledAppointments": "Scheduled appointments",
    "dashboard.last30Days": "Last 30 Days",
    "dashboard.totalBookings": "Total bookings",
    "dashboard.activeServices": "Active Services",
    "dashboard.availableForBooking": "Available for booking",
    "dashboard.noUpcomingBookings": "No upcoming bookings",
    "dashboard.shareYourBookingPage": "Share your booking page to start receiving appointments",
    "dashboard.welcomeNewBusiness": "Welcome to FlowLift",
    "dashboard.setupNewBusiness": "Let's set up your business profile to start accepting bookings.",
    "dashboard.setupButton": "Set Up Your Business",
    "dashboard.viewBookingPage": "View Booking Page",
    
    "settings.yourBusiness": "Your Business",
    "settings.businessNamePlaceholder": "Your Business Name",
    "settings.setupFirst": "Please set up your business profile first.",
    
    "email.bookingConfirmed": "Booking Confirmed",
    "email.appointmentScheduled": "Your appointment has been scheduled",
    "email.date": "Date",
    "email.time": "Time",
    "email.duration": "Duration",
    "email.price": "Price",
    "email.minutes": "minutes",
    "email.businessDetails": "Business Details",
    "email.needChanges": "Need to make changes? Contact {businessName} directly.",
    "email.poweredBy": "Powered by FlowLift",
    
    "auth.signedIn": "Signed in",
    "auth.viewManageBookings": "You can now view and manage your bookings.",
    "auth.errorVerifyToken": "Failed to verify token",
    
    "myBookings.viewTitle": "View Your Bookings",
    "myBookings.enterEmailDesc": "Enter your email to access your booking history",
    "myBookings.checkEmail": "Check your email",
    "myBookings.sentSignInLink": "We've sent a sign-in link to {email}",
    "myBookings.tryDifferentEmail": "Try a different email",
    "myBookings.enterEmailPlaceholder": "Enter your email address",
    "myBookings.sending": "Sending...",
    "myBookings.getAccessLink": "Get Access Link",
    "myBookings.sentAccessLink": "We've sent you a link to access your bookings.",
    "myBookings.bookingCancelled": "Booking cancelled",
    "myBookings.bookingCancelledDesc": "Your booking has been cancelled successfully.",
    "myBookings.myBookingsTitle": "My Bookings",
    "myBookings.viewManageAppointments": "View and manage your appointments",
    "myBookings.upcoming": "Upcoming",
    "myBookings.past": "Past",
    "myBookings.bookAgain": "Book Again",
    "myBookings.cancel": "Cancel",
    "myBookings.completed": "Completed",
    "myBookings.cancelBooking": "Cancel Booking",
    "myBookings.keepBooking": "Keep Booking",
    "myBookings.cancelBookingConfirm": "Are you sure you want to cancel your booking for {serviceName} on {date}?",
    "myBookings.pastCancelled": "Past & Cancelled",
    "myBookings.noBookingsYet": "No bookings yet",
    "myBookings.noBookingsEmailDesc": "You haven't made any bookings with this email address.",
  },
  es: {
    "app.name": "FlowLift",
    "app.tagline": "Reservas inteligentes para negocios de servicios",
    
    "nav.dashboard": "Panel",
    "nav.services": "Servicios",
    "nav.bookings": "Reservaciones",
    "nav.availability": "Disponibilidad",
    "nav.settings": "Configuración",
    "nav.team": "Equipo",
    "nav.logout": "Cerrar sesión",
    
    "sidebar.menu": "Menú",
    "sidebar.quickActions": "Acciones Rápidas",
    
    "landing.hero.title": "Reservas Inteligentes para",
    "landing.hero.titleHighlight": "Negocios de Servicios",
    "landing.hero.subtitle": "Deja de hacer malabares con llamadas y mensajes. Permite que tus clientes reserven citas en línea mientras te enfocas en lo que mejor haces.",
    "landing.hero.cta": "Comenzar Gratis",
    "landing.hero.learnMore": "Más Información",
    "landing.signIn": "Iniciar Sesión",
    
    "landing.features.title": "Todo lo que Necesitas para Gestionar Reservas",
    "landing.features.subtitle": "Herramientas simples y poderosas diseñadas para pequeños negocios de servicios",
    "landing.features.easyScheduling": "Programación Fácil",
    "landing.features.easySchedulingDesc": "Permite que los clientes reserven citas las 24 horas con tu página de reservas personalizada",
    "landing.features.availabilityControl": "Control de Disponibilidad",
    "landing.features.availabilityControlDesc": "Configura tus horarios de trabajo, descansos y bloquea tiempo cuando no estés disponible",
    "landing.features.customerManagement": "Gestión de Clientes",
    "landing.features.customerManagementDesc": "Rastrea reservas, detalles de clientes y notas en un solo lugar",
    "landing.features.simpleAnalytics": "Analíticas Simples",
    "landing.features.simpleAnalyticsDesc": "Ve tus próximas reservas y rastrea el crecimiento de tu negocio",
    
    "landing.benefits.title": "Creado para Profesionales de Servicios",
    "landing.benefits.subtitle": "Ya seas barbero, estilista, masajista o negocio de renta",
    "landing.benefits.noDoubleBookings": "Sin reservas dobles",
    "landing.benefits.mobileFriendly": "Página de reservas optimizada para móvil",
    "landing.benefits.instantConfirmations": "Confirmaciones instantáneas",
    "landing.benefits.multipleServices": "Gestiona múltiples servicios",
    "landing.benefits.customProfile": "Perfil de negocio personalizado",
    "landing.benefits.multiTenant": "Listo para múltiples negocios",
    
    "landing.cta.title": "¿Listo para Optimizar tus Reservas?",
    "landing.cta.subtitle": "Únete a negocios que ahorran horas cada semana con programación automatizada",
    "landing.cta.button": "Comenzar Gratis Hoy",
    
    "booking.selectService": "Selecciona un Servicio",
    "booking.noServices": "No hay servicios disponibles en este momento.",
    "booking.select": "Seleccionar",
    "booking.back": "Atrás",
    "booking.selectedService": "Servicio Seleccionado",
    "booking.selectDate": "Seleccionar Fecha",
    "booking.availableTimes": "Horarios Disponibles",
    "booking.selectDateFirst": "Selecciona una Fecha Primero",
    "booking.pleaseSelectDate": "Por favor selecciona una fecha para ver horarios disponibles",
    "booking.noSlots": "No hay horarios disponibles para esta fecha",
    "booking.summary": "Resumen de Reserva",
    "booking.yourDetails": "Clientes",
    "booking.name": "Nombre",
    "booking.email": "Correo Electrónico",
    "booking.phone": "Teléfono (Opcional)",
    "booking.notes": "Notas (Opcional)",
    "booking.confirmBooking": "Confirmar Reserva",
    "booking.processing": "Procesando...",
    "booking.confirmed": "¡Reserva Confirmada!",
    "booking.thankYou": "Gracias por reservar con",
    "booking.confirmationSent": "Se ha enviado un correo de confirmación a tu dirección de correo. Puedes gestionar todas tus reservas desde tu cuenta.",
    "booking.requestSubmitted": "Solicitud de Reserva Enviada",
    "booking.pendingConfirmation": "Tu solicitud de reserva ha sido enviada a {business}. Por favor espera la confirmación.",
    "booking.pendingConfirmationNote": "El negocio revisará tu solicitud y te enviará un correo de confirmación una vez aprobada.",
    "booking.bookAnother": "Reservar Otra Cita",
    "booking.viewMyBookings": "Ver Mis Reservas",
    "booking.businessNotFound": "Negocio No Encontrado",
    "booking.businessNotFoundDesc": "La página de reservas que buscas no existe.",
    "booking.step.service": "Servicio",
    "booking.step.datetime": "Fecha y Hora",
    "booking.step.details": "Detalles",
    "booking.min": "min",
    "booking.addToCalendar": "Agregar al Calendario",
    "booking.googleCalendar": "Google Calendar",
    "booking.outlookCalendar": "Outlook",
    "booking.appleCalendar": "Apple Calendar",
    
    "settings.title": "Configuración del Negocio",
    "settings.subtitle": "Administra tu perfil de negocio y página de reservas",
    "settings.businessInfo": "Información del Negocio",
    "settings.businessName": "Nombre del Negocio",
    "settings.category": "Categoría",
    "settings.selectCategory": "Selecciona una categoría",
    "settings.bookingPageUrl": "URL de Página de Reservas",
    "settings.urlDescription": "Esta es la URL donde los clientes reservarán tus servicios",
    "settings.description": "Descripción",
    "settings.descriptionPlaceholder": "Cuéntale a los clientes sobre tu negocio...",
    "settings.location": "Ubicación",
    "settings.address": "Dirección",
    "settings.city": "Ciudad",
    "settings.country": "País",
    "settings.contact": "Contacto",
    "settings.phone": "Teléfono",
    "settings.email": "Correo Electrónico",
    "settings.previewBooking": "Vista Previa de Reservas",
    "settings.save": "Actualizar",
    "settings.create": "Crear Negocio",
    "settings.saving": "Guardando...",
    "settings.changeLogo": "Cambiar Logo",
    "settings.uploading": "Subiendo...",
    "settings.urlCopied": "¡URL de reservas copiada!",
    "settings.profileSaved": "Perfil de negocio guardado",
    "settings.logoUpdated": "Logo actualizado exitosamente",
    "settings.language": "Idioma",
    "settings.languageDescription": "Selecciona tu idioma preferido para la app y notificaciones por correo",
    "settings.preferences": "Preferencias",
    
    "services.title": "Servicios",
    "services.subtitle": "Administra los servicios que ofreces a los clientes",
    "services.addService": "Agregar Servicio",
    "services.editService": "Editar Servicio",
    "services.noServices": "Sin servicios aún",
    "services.noServicesDesc": "Agrega tu primer servicio para comenzar a aceptar reservas",
    "services.name": "Nombre del Servicio",
    "services.description": "Descripción",
    "services.duration": "Duración (minutos)",
    "services.price": "Precio",
    "services.tags": "Etiquetas",
    "services.tagsPlaceholder": "Agregar etiquetas (separadas por coma)",
    "services.active": "Activo",
    "services.requiresConfirmation": "Requiere Confirmación",
    "services.requiresConfirmationDesc": "Las reservas requieren tu aprobación antes de ser confirmadas",
    "services.confirmation": "Confirmación",
    "services.save": "Guardar Servicio",
    "services.cancel": "Cancelar",
    "services.delete": "Eliminar",
    "services.deleteConfirm": "¿Estás seguro de que quieres eliminar este servicio?",
    
    "bookings.title": "Reservas",
    "bookings.subtitle": "Ve y gestiona las citas de tus clientes",
    "bookings.noBookings": "Sin reservas aún",
    "bookings.noBookingsDesc": "Cuando los clientes reserven citas, aparecerán aquí",
    "bookings.calendar": "Calendario",
    "bookings.list": "Lista",
    "bookings.upcoming": "Próximas",
    "bookings.past": "Pasadas",
    "bookings.all": "Todas",
    "bookings.pending": "Pendiente",
    "bookings.confirmed": "Confirmada",
    "bookings.cancelled": "Cancelada",
    "bookings.confirm": "Confirmar",
    "bookings.cancel": "Cancelar",
    "bookings.viewDetails": "Ver Detalles",
    "bookings.cancelBooking": "Cancelar Reserva",
    "bookings.customerNotes": "Notas del Cliente",
    "bookings.internalNotes": "Notas Internas",
    "bookings.modify": "Modificar",
    "bookings.modifyBooking": "Modificar Reserva",
    "bookings.modificationPending": "Modificación Pendiente",
    "bookings.currentAppointment": "Cita Actual",
    "bookings.proposedNewDate": "Nueva Fecha Propuesta",
    "bookings.startTime": "Hora de Inicio",
    "bookings.endTime": "Hora de Fin",
    "bookings.selectTime": "Seleccionar hora",
    "bookings.reasonForChange": "Razón del Cambio",
    "bookings.reasonForChangePlaceholder": "Opcional: explica por qué se necesita este cambio",
    "bookings.sendModificationRequest": "Enviar Solicitud de Modificación",
    "bookings.modificationRequestSent": "Solicitud de modificación enviada al cliente",
    "bookings.modificationRequestFailed": "Error al enviar solicitud de modificación",
    
    "confirmModification.title": "Confirmar Cambio de Cita",
    "confirmModification.subtitle": "Por favor revisa los cambios propuestos a tu cita",
    "confirmModification.currentTime": "Hora Actual",
    "confirmModification.proposedTime": "Nueva Hora Propuesta",
    "confirmModification.reason": "Razón del Cambio",
    "confirmModification.confirm": "Confirmar Cambio",
    "confirmModification.confirming": "Confirmando...",
    "confirmModification.confirmed": "¡Cita Actualizada!",
    "confirmModification.confirmedDesc": "Tu cita ha sido actualizada a la nueva hora.",
    "confirmModification.notFound": "Solicitud No Encontrada",
    "confirmModification.notFoundDesc": "Esta solicitud de modificación no fue encontrada o ha expirado.",
    "confirmModification.expired": "Solicitud Expirada",
    "confirmModification.expiredDesc": "Esta solicitud de modificación ha expirado. Por favor contacta al negocio.",
    "confirmModification.error": "Error",
    "confirmModification.errorDesc": "Hubo un error al procesar tu solicitud.",

    "customerCancel.title": "Cancelar Reserva",
    "customerCancel.subtitle": "Por favor confirma que deseas cancelar esta reserva",
    "customerCancel.bookingDetails": "Detalles de la Reserva",
    "customerCancel.service": "Servicio",
    "customerCancel.date": "Fecha",
    "customerCancel.time": "Hora",
    "customerCancel.business": "Negocio",
    "customerCancel.reasonLabel": "Razón de la cancelación (opcional)",
    "customerCancel.reasonPlaceholder": "Por favor cuéntanos por qué estás cancelando...",
    "customerCancel.confirmCancel": "Cancelar Reserva",
    "customerCancel.cancelling": "Cancelando...",
    "customerCancel.cancelled": "Reserva Cancelada",
    "customerCancel.cancelledDesc": "Tu reserva ha sido cancelada exitosamente.",
    "customerCancel.notFound": "Reserva No Encontrada",
    "customerCancel.notFoundDesc": "Este enlace de reserva es inválido o ya ha sido cancelado.",
    "customerCancel.alreadyCancelled": "Ya Cancelada",
    "customerCancel.alreadyCancelledDesc": "Esta reserva ya ha sido cancelada.",
    "customerCancel.error": "Error",
    "customerCancel.errorDesc": "Hubo un error al cancelar tu reserva.",
    "customerCancel.goBack": "Volver",
    "customerCancel.keepBooking": "Mantener Reserva",

    "customerModify.title": "Modificar Reserva",
    "customerModify.subtitle": "Cambia la fecha u hora de tu cita",
    "customerModify.currentBooking": "Reserva Actual",
    "customerModify.service": "Servicio",
    "customerModify.date": "Fecha",
    "customerModify.time": "Hora",
    "customerModify.business": "Negocio",
    "customerModify.changeTime": "Cambiar Fecha/Hora",
    "customerModify.selectNewTime": "Selecciona Nueva Fecha y Hora",
    "customerModify.selectDate": "Selecciona Fecha",
    "customerModify.selectTime": "Selecciona Hora",
    "customerModify.selectDateFirst": "Por favor selecciona una fecha primero",
    "customerModify.noSlots": "No hay horarios disponibles para esta fecha",
    "customerModify.continue": "Continuar",
    "customerModify.confirmChange": "Confirmar Cambio",
    "customerModify.newBooking": "Nueva Reserva",
    "customerModify.confirmModify": "Confirmar Modificación",
    "customerModify.modifying": "Modificando...",
    "customerModify.modified": "Reserva Modificada",
    "customerModify.modifiedDesc": "Tu cita ha sido reprogramada exitosamente.",
    "customerModify.newDate": "Nueva Fecha",
    "customerModify.newTime": "Nueva Hora",
    "customerModify.notFound": "Reserva No Encontrada",
    "customerModify.notFoundDesc": "Este enlace de reserva es inválido o ha expirado.",
    "customerModify.alreadyCancelled": "Reserva Cancelada",
    "customerModify.alreadyCancelledDesc": "Esta reserva ha sido cancelada y no puede ser modificada.",
    "customerModify.error": "Error",
    "customerModify.errorDesc": "Hubo un error al cargar tu reserva.",
    "customerModify.goBack": "Volver",

    "team.title": "Equipo",
    "team.subtitle": "Gestiona tu equipo y sus horarios",
    "team.addMember": "Agregar Miembro",
    "team.editMember": "Editar Miembro",
    "team.members": "Miembros del Equipo",
    "team.noMembers": "Aún no hay miembros. Agrega tu primer miembro del equipo para comenzar.",
    "team.selectMember": "Selecciona un Miembro",
    "team.selectMemberDescription": "Haz clic en un miembro del equipo para gestionar sus servicios y disponibilidad.",
    "team.name": "Nombre",
    "team.namePlaceholder": "Ingresa el nombre del miembro",
    "team.email": "Correo electrónico",
    "team.emailPlaceholder": "Ingresa el correo electrónico",
    "team.phone": "Teléfono",
    "team.phonePlaceholder": "Ingresa el número de teléfono",
    "team.role": "Rol",
    "team.rolePlaceholder": "ej., Estilista, Barbero, Terapeuta",
    "team.roleDescription": "El rol o especialización de este miembro",
    "team.active": "Activo",
    "team.activeDescription": "Los miembros inactivos no se mostrarán para reservas",
    "team.inactive": "Inactivo",
    "team.services": "Servicios",
    "team.servicesDescription": "Selecciona qué servicios puede realizar este miembro",
    "team.noServicesAvailable": "No hay servicios disponibles. Crea servicios primero.",
    "team.availability": "Disponibilidad",
    "team.availabilityDescription": "Configura las horas de trabajo para cada día de la semana",
    "team.created": "Miembro del equipo creado exitosamente",
    "team.createError": "Error al crear miembro del equipo",
    "team.updated": "Miembro del equipo actualizado exitosamente",
    "team.updateError": "Error al actualizar miembro del equipo",
    "team.deleted": "Miembro del equipo eliminado exitosamente",
    "team.deleteError": "Error al eliminar miembro del equipo",
    "team.servicesUpdated": "Servicios actualizados exitosamente",
    "team.servicesError": "Error al actualizar servicios",
    "team.availabilityUpdated": "Disponibilidad actualizada exitosamente",
    "team.availabilityError": "Error al actualizar disponibilidad",
    "team.deleteConfirmTitle": "¿Eliminar Miembro?",
    "team.deleteConfirmDescription": "Esto eliminará permanentemente este miembro del equipo y todos sus horarios. Esta acción no se puede deshacer.",
    "team.setupBusinessFirst": "Por favor, configura tu perfil de negocio primero.",
    
    "common.sending": "Enviando...",
    "common.fillAllFields": "Por favor completa todos los campos requeridos",
    
    "availability.title": "Disponibilidad",
    "availability.subtitle": "Configura tus horarios de trabajo y gestiona franjas horarias",
    "availability.workingHours": "Horarios de Trabajo",
    "availability.closed": "Cerrado",
    "availability.open": "Abierto",
    "availability.startTime": "Hora de Inicio",
    "availability.endTime": "Hora de Fin",
    "availability.slotDuration": "Duración de Franja",
    "availability.maxPerSlot": "Máximo de Reservas por Franja",
    "availability.save": "Guardar Disponibilidad",
    "availability.saved": "Disponibilidad guardada exitosamente",
    "availability.to": "a",
    "availability.slotLabel": "Duración:",
    "availability.startDate": "Fecha de Inicio",
    "availability.endDate": "Fecha de Fin",
    "availability.reason": "Razón (opcional)",
    "availability.setupFirst": "Por favor, configura tu perfil de negocio primero.",
    "common.noBookingsOnDate": "No hay reservas en esta fecha",
    
    "dashboard.title": "Panel",
    "dashboard.welcome": "Bienvenido de nuevo",
    "dashboard.todayBookings": "Reservas de Hoy",
    "dashboard.upcomingBookings": "Próximas Reservas",
    "dashboard.totalServices": "Total de Servicios",
    "dashboard.recentBookings": "Reservas Recientes",
    "dashboard.viewAll": "Ver Todo",
    "dashboard.noBookingsToday": "No hay reservas programadas para hoy",
    "dashboard.setupBusiness": "Configura tu negocio",
    "dashboard.setupBusinessDesc": "Completa tu perfil de negocio para comenzar a aceptar reservas",
    "dashboard.goToSettings": "Ir a Configuración",
    
    "myBookings.title": "Mis Reservas",
    "myBookings.subtitle": "Ve y gestiona tus citas",
    "myBookings.enterEmail": "Ingresa tu correo para ver reservas",
    "myBookings.email": "Correo Electrónico",
    "myBookings.sendLink": "Enviar Enlace Mágico",
    "myBookings.linkSent": "Revisa tu correo para el enlace de acceso",
    "myBookings.noBookings": "No se encontraron reservas",
    "myBookings.noBookingsDesc": "Reserva una cita con un negocio para verla aquí",
    
    "days.sunday": "Domingo",
    "days.monday": "Lunes",
    "days.tuesday": "Martes",
    "days.wednesday": "Miércoles",
    "days.thursday": "Jueves",
    "days.friday": "Viernes",
    "days.saturday": "Sábado",
    
    "categories.barber": "Barbería",
    "categories.hairdresser": "Salón de Belleza",
    "categories.beauty_salon": "Salón de Belleza",
    "categories.spa": "Spa y Bienestar",
    "categories.massage": "Terapia de Masaje",
    "categories.nail_salon": "Salón de Uñas",
    "categories.inflatable_rentals": "Renta de Inflables",
    "categories.party_services": "Servicios para Fiestas",
    "categories.photography": "Fotografía",
    "categories.fitness": "Fitness y Entrenamiento",
    "categories.consulting": "Consultoría",
    "categories.other": "Otros Servicios",
    
    "common.loading": "Cargando...",
    "common.error": "Ocurrió un error",
    "common.save": "Guardar",
    "common.cancel": "Cancelar",
    "common.delete": "Eliminar",
    "common.edit": "Editar",
    "common.add": "Agregar",
    "common.search": "Buscar",
    "common.filter": "Filtrar",
    "common.required": "Requerido",
    "common.optional": "Opcional",
    "common.unauthorized": "No autorizado",
    "common.loggingIn": "Has cerrado sesión. Iniciando sesión de nuevo...",
    "common.failedToSave": "Error al guardar",
    "common.confirmed": "Confirmado",
    "common.pending": "Pendiente",
    "common.cancelled": "Cancelado",
    "common.status": "Estado",
    "common.actions": "Acciones",
    "common.inactive": "Inactivo",
    "common.deleting": "Eliminando...",
    "common.blockedTime": "Tiempo Bloqueado",
    "common.addBlockedTime": "Agregar Tiempo Bloqueado",
    "common.blockTimeOff": "Bloquear Tiempo Libre",
    "common.noBlockedTimeScheduled": "Sin tiempo bloqueado programado",
    "common.addTimeOffDescription": "Agrega tiempo libre para vacaciones, días festivos o descansos",
    "common.commaSeparated": "separadas por coma",
    
    "booking.selectDateTime": "Fecha y Hora",
    
    "dashboard.scheduledAppointments": "Citas programadas",
    "dashboard.last30Days": "Últimos 30 Días",
    "dashboard.totalBookings": "Total de reservas",
    "dashboard.activeServices": "Servicios Activos",
    "dashboard.availableForBooking": "Disponibles para reservar",
    "dashboard.noUpcomingBookings": "No hay próximas reservas",
    "dashboard.shareYourBookingPage": "Comparte tu página de reservas para comenzar a recibir citas",
    "dashboard.welcomeNewBusiness": "Bienvenido a FlowLift",
    "dashboard.setupNewBusiness": "Vamos a configurar tu perfil de negocio para comenzar a aceptar reservas.",
    "dashboard.setupButton": "Configurar tu Negocio",
    "dashboard.viewBookingPage": "Ver Página de Reservas",
    
    "settings.yourBusiness": "Tu Negocio",
    "settings.businessNamePlaceholder": "Nombre de tu Negocio",
    "settings.setupFirst": "Por favor, configura tu perfil de negocio primero.",
    
    "email.bookingConfirmed": "Reserva Confirmada",
    "email.appointmentScheduled": "Tu cita ha sido programada",
    "email.date": "Fecha",
    "email.time": "Hora",
    "email.duration": "Duración",
    "email.price": "Precio",
    "email.minutes": "minutos",
    "email.businessDetails": "Detalles del Negocio",
    "email.needChanges": "¿Necesitas hacer cambios? Contacta a {businessName} directamente.",
    "email.poweredBy": "Desarrollado por FlowLift",
    
    "auth.signedIn": "Iniciaste sesión",
    "auth.viewManageBookings": "Ahora puedes ver y gestionar tus reservas.",
    "auth.errorVerifyToken": "Error al verificar el token",
    
    "myBookings.viewTitle": "Ver Tus Reservas",
    "myBookings.enterEmailDesc": "Ingresa tu correo para acceder a tu historial de reservas",
    "myBookings.checkEmail": "Revisa tu correo",
    "myBookings.sentSignInLink": "Hemos enviado un enlace de inicio de sesión a {email}",
    "myBookings.tryDifferentEmail": "Intentar con otro correo",
    "myBookings.enterEmailPlaceholder": "Ingresa tu dirección de correo",
    "myBookings.sending": "Enviando...",
    "myBookings.getAccessLink": "Obtener Enlace de Acceso",
    "myBookings.sentAccessLink": "Te hemos enviado un enlace para acceder a tus reservas.",
    "myBookings.bookingCancelled": "Reserva cancelada",
    "myBookings.bookingCancelledDesc": "Tu reserva ha sido cancelada exitosamente.",
    "myBookings.myBookingsTitle": "Mis Reservas",
    "myBookings.viewManageAppointments": "Ve y gestiona tus citas",
    "myBookings.upcoming": "Próximas",
    "myBookings.past": "Pasadas",
    "myBookings.bookAgain": "Reservar Otra Cita",
    "myBookings.cancel": "Cancelar",
    "myBookings.completed": "Completada",
    "myBookings.cancelBooking": "Cancelar Reserva",
    "myBookings.keepBooking": "Mantener Reserva",
    "myBookings.cancelBookingConfirm": "¿Estás seguro de que quieres cancelar tu reserva para {serviceName} el {date}?",
    "myBookings.pastCancelled": "Pasadas y Canceladas",
    "myBookings.noBookingsYet": "Sin reservas aún",
    "myBookings.noBookingsEmailDesc": "No has hecho ninguna reserva con esta dirección de correo.",
  },
};

async function detectUserCountry(): Promise<string | null> {
  try {
    const response = await fetch("https://ipapi.co/json/", { signal: AbortSignal.timeout(3000) });
    if (response.ok) {
      const data = await response.json();
      return data.country_code || null;
    }
  } catch {
    // Fallback silently
  }
  return null;
}

export function I18nProvider({ children }: { children: ReactNode }) {
  const [language, setLanguageState] = useState<Language>(() => {
    const saved = localStorage.getItem("flowlift-language");
    if (saved === "en" || saved === "es") return saved;
    return "en";
  });
  const [initialized, setInitialized] = useState(false);

  useEffect(() => {
    const initLanguage = async () => {
      const saved = localStorage.getItem("flowlift-language");
      if (saved) {
        setInitialized(true);
        return;
      }

      const country = await detectUserCountry();
      if (country && SPANISH_SPEAKING_COUNTRIES.includes(country)) {
        setLanguageState("es");
        localStorage.setItem("flowlift-language", "es");
      }
      setInitialized(true);
    };

    initLanguage();
  }, []);

  const setLanguage = (lang: Language) => {
    setLanguageState(lang);
    localStorage.setItem("flowlift-language", lang);
  };

  const t = (key: string, params?: Record<string, string | number>): string => {
    let text = translations[language][key] || translations.en[key] || key;
    
    if (params) {
      Object.entries(params).forEach(([paramKey, value]) => {
        text = text.replace(`{${paramKey}}`, String(value));
      });
    }
    
    return text;
  };

  return (
    <I18nContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error("useI18n must be used within I18nProvider");
  }
  return context;
}

export function LanguageSwitcher({ minimal = false }: { minimal?: boolean }) {
  const { language, setLanguage } = useI18n();

  if (minimal) {
    return (
      <button
        onClick={() => setLanguage(language === "en" ? "es" : "en")}
        className="px-2 py-1 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors"
        data-testid="button-language-switch"
        aria-label={language === "en" ? "Switch to Spanish" : "Switch to English"}
      >
        {language === "en" ? "ES" : "EN"}
      </button>
    );
  }

  return (
    <div className="flex gap-1 p-1 bg-muted rounded-md">
      <button
        onClick={() => setLanguage("en")}
        className={`px-3 py-1.5 text-sm font-medium rounded transition-colors ${
          language === "en"
            ? "bg-background text-foreground shadow-sm"
            : "text-muted-foreground hover:text-foreground"
        }`}
        data-testid="button-language-en"
      >
        English
      </button>
      <button
        onClick={() => setLanguage("es")}
        className={`px-3 py-1.5 text-sm font-medium rounded transition-colors ${
          language === "es"
            ? "bg-background text-foreground shadow-sm"
            : "text-muted-foreground hover:text-foreground"
        }`}
        data-testid="button-language-es"
      >
        Español
      </button>
    </div>
  );
}
